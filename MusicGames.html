<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" type="text/css" href="stylesheet.css">
	<script src="UserInterface.js"></script>
	<script src="GameData.js"></script>
	<script src="Game.js"></script>
</head>

<body>
	<div id="pageContainer">
		<div id="gameContainer">
			<div id="screenOverlay">
				<div ></div>
				<div id="startContainer">
					<h3>Ready?</h3>
					<button id="startButton">Start</button>
				</div>
				<div></div>
			</div>

			<div id="gameHeader">
				<p>header</p>
			</div>

			<div id="choiceContainer">
				<div class="choiceRow">
					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>

					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>

					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>
				</div>

				<div class="choiceRow">
					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>

					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>

					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>
				</div>

				<div class="choiceRow">
					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>

					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>

					<span class="choiceOverlay">
						<div class="gameChoice">
								<img class="choiceImage blurred"/>
								<div class="songInformationContainer blurred">
									<p>Song title</p>
									<p>Artist name</p>
								</div>
						</div>
					</span>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">

		// Data -------------------

		var spotifyIds = ['5Yj0cfzPPokzpjUa516jsb', '0bV4WoGRzmYV6y7OojZvqr', '66jBbrVByFETJZ6FfpwxX4', '4nuPrKithHbRJXuA9spwu4', '0D7L4pBEGv8ni1cRfaTdMJ', '6roaUdrIQUlTcujSFLtYKI', '7bdDULyOUqNyWu6XPeAnSO', '5vVuiXoHyRGxJeCaHUpgae', '5LyzPhFwF7MgUY3aQD9TAG', '2dcpVsjiNG2eCE1A0jHzzQ', '5Yq58BC5k14EVUJ63cmg8g', '5VU6nvX3BqkqBmOJ2d9vhW', '4Wr14AISsCuBGdkA6rids4', '0BX0eq3SXW4jeZmQ271CpE', '4MvypG63QYhgFml4PbkycS', '1AhDOtG9vPSOmsWgNW0BEY', '2lBilUJAUX9jCNbbpPRQDD', '0vE1E6ZNJGlCHPe95z5Orl', '1VkjgkPh2joHQFXPxALE4w', '714hERk9U1W8FMYkoC83CO', '3FMaoRyUZ07NQIMlCDAEOi', '7ryYUwyBWKnXY4Ebs7F9Ju', '7paiew5fG14JcbGCCpJ0P5', '69rMjPtfWbelVGHM0TZaAr', '7mSUMlp8ttG8H00RePyZ5J', '4hDDfS0yW4YH0VGsJEjSM8', '4j3nXukQfT5RZTdqgZiKt1', '5VAKsbOWGdBbg1VFlu9W8o', '4bEtg70srLrCqQp3Nm2T5R', '3qVQ4akZVrjKXGE4czz8mI', '7cNq0FTl3GYjLc3g232hdA', '7c52LVpkxq3dzMEkDWiQyw', '0MGO9t2qWvKClhjVtzE8tA', '74DrA5fFoGSy4xgkZarZtP', '6qQrGkO4grQ7wKCxhtX1io', '55pdXiMNJNQxehrjkcwmYL', '65ANSaYbBQK6z8fOl0TWVd', '5phyXUNMfJv76epjasKNDS', '7m3dKsll00vBjZqYgZuP62', '69eoS6bEWWfMac4TL36UiM', '2lYe3AhO4dJhBMsvk9uBkw', '3I7bYwN9cMsXm5HqEH76Vv', '4IYoyOVK9oQyJS1QZt5Vyj', '0KMGxYKeUzK9wc5DZCt3HT', '20MxJN12WEqU5eWsuCrwM5', '65uzzraBcb1BE3BiYEztd7', '07KHJvlYBeQVqrmifTEqEp', '7IoKA8yRibsK8Ryy4SH2NL', '2kOOxUIHZvz4TsYE6kHYjb', '3AdX0KdVoMBqe82b19rWAU', '7tV4IBfyJN1E9rC9lxkl2Z', '6BJTagJUFeUxHpVWxTmatw', '58tKMD5v0R4H6ZtgHNyGbO', '5lSvRiMiLnG5HIpcQH4MAz', '3Hp66WUQ6yu69jMrirhSRs', '6J9paEX8rcBYuAIawdnzUj', '3VXoFBJ67ceuFqFdXd6vld', '0qbVccbQLEMbfJcI5wNLTJ', '0FF6HAfbuaVpZC8td4WcmN', '5eze4FmXWb2LvtuMRGcOXq', '2skIFujR9zTTAEXj8tfrw0', '05zCw24BdvZKGeC5NXowVe', '4UN5z3IkTamNxngTsS3Qrm', '763jJ8T1utfvNqz1WRDzx4', '2JOQYyJH6lG8hxpzmInRX0', '5TWPfkeN07aERO0Yn2D2t2', '77PCWchIQ9Dopdp5sahDEc', '67J6NR2Tdl0h2epWHcCBBN', '5dFoWIiJ2814hRwMYDcFiU', '32UDt5O32Ju7gTQWI3Pb7c', '5YtxOL4iUchhynLL9nEBwQ', '4MYb7NWLwXNDB7bYs3HeX8', '29VPObDt1Sg0YBwv8x8aHE', '4QEbXYWpDDWHzXNINdZlzW', '7odZlvyjhlFESLeu2PSZ5z', '2CsghsYEVWEgACHtecmCCj', '3MFa9idQuY4iJLWsZl3tIQ', '7utoClKnLShFg6u6dZ20gp', '3OALvGFqkjzwylB345KOVt', '3KGM2fm1K3p5alOyHGzTyY', '5XEsQ97NshBJ02yXpFSkTa', '1dCZvxf24rGMQNOamU9yy2', '3WOmG6u7bxrcFXwfiKMk80', '093Yob0qYlv7p4KdOXbkB4', '6fobsZ84ye4LF4m9IhsJH4', '4xsjEa8mfniPVJ58lKFP8e', '0WeJT7rCshvzK5BOBiAjBn'];


		// Classes -------------------

		// Functions -------------------

		function replaceSpaces(string) {
			// returns the supplied string with all spaces replaced by %20
			// so it can be used in the spotify search call

			if (string.indexOf(' ') > -1) {
				return replaceSpaces(string.replace(' ', '%20'));
			}

			else {
				return string;
			}
		}

		function getSpotifySearchUrl(artist, trackName, searchType) {
			// creates an appropriate url to call the search api.
			//
			// a quick test showed searching for both artist and track
			// made it harder to match the specific song so this makes
			// a track name search

			var baseSearchUrl = "https://api.spotify.com/v1/search?q=";

			var searchableArtist = replaceSpaces(artist);
			var searchableTrack = replaceSpaces(trackName);

			var artistQuery = "artist:" + searchableArtist;
			var trackQuery = "track:" + searchableTrack;
			var typeQuery = "type=" + searchType;

			//var constructed_query = artistQuery + "&" + trackQuery + "&" + typeQuery;
			var constructed_query = trackQuery + "&" + typeQuery;
			var searchUrl = baseSearchUrl + constructed_query;

			return searchUrl;
		}

		function getSpotifySearchResults(constructedUrl) {
			// call the spotify search api with the supplied url
			// returns a JSON formatted object of the search results

			var searchRequest = new XMLHttpRequest();

			searchRequest.open("GET", constructedUrl, false);
			searchRequest.send(null);

			return JSON.parse(searchRequest.responseText);
		}

		function getSongMatchFromResults(artist, trackName, spotifyTracks) {
			// compares an artist and track to an array of spotify tracks taken
			// from the spotify search results, returns an exact track and artist
			// match immediately, otherwise returns a track match, or null

			var bestTrackResult = null;

			for (var i = 0; i < spotifyTracks.length; i++) {
				var trackNameResult = spotifyTracks[i].name;
				var artistsResult = spotifyTracks[i].artists;

				if (trackName.toLowerCase() == trackNameResult.toLowerCase()) {
					if (bestTrackResult === null) {
						bestTrackResult = spotifyTracks[i];
					}

					for (var j = 0; j < artistsResult.length; j++) {
						var artistName = artistsResult[j].name;

						if (artist.toLowerCase() == artistName.toLowerCase()) {
							return spotifyTracks[i];
						}
					}
				}
			}

			//console.log('Returning best result for:', artist, trackName, bestTrackResult);
			return bestTrackResult;
		}

		function getTrackBySpotifyId(spotifyId) {
			var getTrackUrlBase = 'https://api.spotify.com/v1/tracks/' // +{id}
			var fullUrl = getTrackUrlBase + spotifyId;

			var trackRequest = new XMLHttpRequest();
			trackRequest.open("GET", fullUrl, false);
			trackRequest.send(null);

			return JSON.parse(trackRequest.responseText);
		}

		function trackHasAlbumArt(track) {
			// returns true or false
			if (track.album.images.length == 3) {
				return true;
			}
			return false;
		}

		function getArtUrlsFromSongSet(songSet) {
			console.log('getting art urls with', songSet);
			artSet = [];

			for (var i = 0; i < songSet.length; i++) {
				console.log(i, songSet[i]);
				if (songSet[i].album.images.length != 3) {
					artSet.push("missing");
				}

				else {
					artSet.push(songSet[i].album.images[1].url);
				}
			}

			return artSet;
		}

		function createImageFromUrl(imageUrl) {
			var img = new Image();
			img.src = imageUrl;

			return img;
		}

		function updateImageSources(imageElements, imageSrcs) {
			if (imageElements.length != imageSrcs.length) {
				alert("Couldn't update images");
				return;
			}

			for (var i = 0; i < imageElements.length; i++) {
				imageElements[i].src = imageSrcs[i];
			}
		}

		function addClassToElement(element, newClassName) {
			element.classList.add(newClassName);
		}

		function addClassToElementAndChildren(element, newClassName) {
			addClassToElement(element, newClassName);

			if (element.childElementCount > 0) {
				for (var i = 0; i < element.childElementCount; i++) {
					addClassToElementAndChildren(element.children[i], newClassName);
				}
			}
		}

		function removeClassFromElement(element, className) {
			element.classList.remove(className);
		}

		function removeClassFromElementAndChildren(element, className) {
			removeClassFromElement(element, className);

			if (element.childElementCount > 0) {
				for (var i = 0; i < element.childElementCount; i++) {
					removeClassFromElementAndChildren(element.children[i], className);
				}
			}
		}

		// Testing -------------------

		var game = new Game();
		//game.data.idSet = spotifyIds;
		game.initialize();


	</script>

</body>

</html>
